<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>計程車收據生成器 V4.0</title>
    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 1200px; width: 100%; }
        .controls { flex: 1; min-width: 320px; display: flex; flex-direction: column; gap: 15px; }
        .preview { flex: 2; min-width: 500px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; background: #eee; padding: 20px; border-radius: 8px; overflow: auto; }
        h2 { margin-top: 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .section-title { font-size: 14px; font-weight: bold; color: #007bff; margin-top: 10px; margin-bottom: 5px; }
        label { font-weight: bold; font-size: 14px; color: #555; margin-bottom: 5px; display: block; }
        input[type="text"], input[type="number"], input[type="date"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box; }
        .radio-group { display: flex; flex-direction: column; gap: 8px; background: #f9f9f9; padding: 10px; border-radius: 6px; }
        .radio-group label { font-weight: normal; display: flex; align-items: center; cursor: pointer; }
        .radio-group input { margin-right: 10px; }
        button { background-color: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-size: 16px; cursor: pointer; transition: background 0.2s; margin-top: 20px; width: 100%; }
        button:hover { background-color: #0056b3; }
        canvas { box-shadow: 0 2px 10px rgba(0,0,0,0.2); max-width: 100%; height: auto; background: white; }
        .hint { font-size: 12px; color: #888; margin-top: 5px; text-align: center; }
    </style>
</head>
<body>

    <div class="container">
        <div class="controls">
            <h2>收據資訊輸入</h2>
            
            <div class="section-title">基本資訊</div>
            <div>
                <label>日期 (Date)</label>
                <input type="date" id="dateInput">
            </div>

            <div class="section-title">司機與車輛</div>
            <div>
                <label>司機姓名 (Driver Name)</label>
                <input type="text" id="driverInput" placeholder="例如：陳大明">
            </div>
            <div>
                <label>車號 (Car No.)</label>
                <input type="text" id="carNoInput" placeholder="例如：TDC-8888">
            </div>

            <div class="section-title">款項資訊</div>
            <div>
                <label>今收到 (Received From / 抬頭)</label>
                <input type="text" id="buyerInput" value="威禧股份有限公司">
            </div>
            <div>
                <label>統一編號 (Tax ID)</label>
                <input type="text" id="taxIdInput" value="82956208">
            </div>
            <div>
                <label>金額 (Total Amount NTD)</label>
                <input type="number" id="amountInput" placeholder="例如：1200">
            </div>

            <div class="section-title">詳細內容</div>
            <div>
                <label>付款性質 (Account For)</label>
                <div class="radio-group">
                    <label><input type="radio" name="type" value="send" checked> 送機 (To Airport)</label>
                    <label><input type="radio" name="type" value="pickup"> 接機 (From Airport)</label>
                    <label><input type="radio" name="type" value="other"> 其他 (Others)</label>
                </div>
            </div>

            <div id="otherTextInputDiv" style="display:none; margin-top:10px;">
                <input type="text" id="otherTextInput" placeholder="請輸入說明">
            </div>

            <div style="margin-top:15px;">
                <label>備註 (Remarks)</label>
                <input type="text" id="noteInput" placeholder="例如：出差去驗貨">
            </div>

            <button onclick="downloadReceipt()">下載收據 (Download PNG)</button>
        </div>

        <div class="preview">
            <canvas id="receiptCanvas" width="800" height="700"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('receiptCanvas');
        const ctx = canvas.getContext('2d');

        // Inputs
        const dateInput = document.getElementById('dateInput');
        const driverInput = document.getElementById('driverInput');
        const carNoInput = document.getElementById('carNoInput');
        const buyerInput = document.getElementById('buyerInput');
        const taxIdInput = document.getElementById('taxIdInput');
        const amountInput = document.getElementById('amountInput');
        const noteInput = document.getElementById('noteInput');
        const typeInputs = document.getElementsByName('type');
        const otherTextInput = document.getElementById('otherTextInput');
        const otherTextInputDiv = document.getElementById('otherTextInputDiv');

        dateInput.valueAsDate = new Date();

        const inputs = [dateInput, driverInput, carNoInput, buyerInput, taxIdInput, amountInput, noteInput, otherTextInput];
        inputs.forEach(input => input.addEventListener('input', drawReceipt));
        typeInputs.forEach(input => input.addEventListener('change', () => {
            if(input.value === 'other') { otherTextInputDiv.style.display = 'block'; } 
            else { otherTextInputDiv.style.display = 'none'; }
            drawReceipt();
        }));

        // Main Drawing Function
        function drawReceipt() {
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Header
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 36px "Times New Roman", serif';
            ctx.textAlign = 'center';
            ctx.fillText('收    據', canvas.width / 2, 50);
            ctx.font = 'bold 20px "Times New Roman", serif';
            ctx.fillText('RECEIPT', canvas.width / 2, 75);

            // Date
            const dateVal = new Date(dateInput.value);
            const year = dateVal.getFullYear();
            const month = (dateVal.getMonth() + 1).toString().padStart(2, '0');
            const day = dateVal.getDate().toString().padStart(2, '0');
            const dateStr = dateInput.value ? `${year} / ${month} / ${day}` : '';
            ctx.font = '16px "Microsoft JhengHei", sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('日 期', 580, 50);
            ctx.font = '12px "Arial", sans-serif';
            ctx.fillText('DATE', 580, 65);
            drawDottedLine(630, 60, 780, 60);
            ctx.font = '18px "Arial", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(dateStr, 705, 55);

            // Green Bar
            ctx.fillStyle = '#eafaf1'; 
            ctx.fillRect(20, 85, 760, 30);

            // --- Layout Constants ---
            const leftLabelX = 40; const leftEngX = 40; const lineStartX = 200; const lineEndX = 760; const textStartX = 220;
            let currentY = 110; const rowGap = 55;

            // Driver Name
            ctx.fillStyle = '#000000'; ctx.textAlign = 'left';
            ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText('司 機 姓 名', leftLabelX, currentY);
            ctx.font = '12px "Times New Roman", sans-serif'; ctx.fillText('DRIVER NAME', leftEngX, currentY + 15);
            drawDottedLine(lineStartX, currentY + 10, lineEndX, currentY + 10);
            ctx.font = '20px "Microsoft JhengHei", sans-serif'; ctx.fillText(driverInput.value, textStartX, currentY + 5);
            currentY += rowGap;

            // Car Number
            ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText('車           號', leftLabelX, currentY);
            ctx.font = '12px "Times New Roman", sans-serif'; ctx.fillText('CAR NO.', leftEngX, currentY + 15);
            drawDottedLine(lineStartX, currentY + 10, lineEndX, currentY + 10);
            ctx.font = 'bold 20px "Arial", sans-serif'; ctx.fillText(carNoInput.value.toUpperCase(), textStartX, currentY + 5);
            currentY += rowGap;

            // Received From
            ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText('今   收   到', leftLabelX, currentY);
            ctx.font = '12px "Times New Roman", sans-serif'; ctx.fillText('RECEIVED FROM', leftEngX, currentY + 15);
            drawDottedLine(lineStartX, currentY + 10, lineEndX, currentY + 10);
            let buyerText = buyerInput.value;
            if (taxIdInput.value) { buyerText += `  (統編: ${taxIdInput.value})`; }
            ctx.font = '20px "Microsoft JhengHei", sans-serif'; ctx.fillText(buyerText, textStartX, currentY + 5);
            currentY += rowGap;

            // Amount
            ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText('共           計', leftLabelX, currentY);
            ctx.font = '12px "Times New Roman", sans-serif'; ctx.fillText('TOTAL AMOUNT', leftEngX, currentY + 15);
            ctx.font = '16px "Times New Roman", sans-serif'; ctx.fillText('NTD', lineStartX, currentY + 15);
            drawDottedLine(lineStartX + 40, currentY + 10, lineEndX, currentY + 10);
            if (amountInput.value) { ctx.font = 'bold 22px "Arial", sans-serif'; ctx.fillText(parseInt(amountInput.value).toLocaleString(), lineStartX + 60, currentY + 5); }
            currentY += rowGap;

            // Payment Type
            ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText('付 款 性 質', leftLabelX, currentY);
            ctx.font = '12px "Times New Roman", sans-serif'; ctx.fillText('ACCOUNT FOR', leftEngX, currentY + 15);
            let selectedType = ''; for(const r of typeInputs) { if(r.checked) selectedType = r.value; }
            const cbY = currentY - 5;
            drawCheckbox(lineStartX, cbY, selectedType === 'send'); ctx.font = '16px "Microsoft JhengHei", sans-serif'; ctx.fillText('送機 (To Airport)', lineStartX + 30, cbY + 15);
            drawCheckbox(lineStartX + 200, cbY, selectedType === 'pickup'); ctx.fillText('接機 (From Airport)', lineStartX + 230, cbY + 15);
            const cbRow2Y = cbY + 35;
            drawCheckbox(lineStartX, cbRow2Y, selectedType === 'other'); ctx.fillText('其他 (Others):', lineStartX + 30, cbRow2Y + 15);
            drawDottedLine(lineStartX + 140, cbRow2Y + 15, lineEndX, cbRow2Y + 15);
            if(selectedType === 'other' && otherTextInput.value) { ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText(otherTextInput.value, lineStartX + 150, cbRow2Y + 10); }
            currentY += 100;

            // Remarks
            ctx.fillStyle = '#000000';
            ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText('備           註', leftLabelX, currentY);
            ctx.font = '12px "Times New Roman", sans-serif'; ctx.fillText('REMARKS', leftEngX, currentY + 15);
            drawDottedLine(lineStartX, currentY + 10, lineEndX, currentY + 10);
            if(noteInput.value) { ctx.font = '18px "Microsoft JhengHei", sans-serif'; ctx.fillText(noteInput.value, textStartX, currentY + 5); }

            // Stamp
            drawCorrectedStamp(700, currentY - 30); 
        }

        // Helper Functions
        function drawDottedLine(x1, y1, x2, y2) {
            ctx.beginPath(); ctx.setLineDash([2, 4]); ctx.strokeStyle = '#999'; ctx.lineWidth = 1;
            ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke(); ctx.setLineDash([]); 
        }
        function drawCheckbox(x, y, checked) {
            ctx.beginPath(); ctx.strokeStyle = '#000'; ctx.lineWidth = 1; ctx.rect(x, y, 18, 18); ctx.stroke();
            if (checked) { ctx.beginPath(); ctx.moveTo(x + 3, y + 9); ctx.lineTo(x + 8, y + 14); ctx.lineTo(x + 16, y + 4); ctx.strokeStyle = '#000'; ctx.lineWidth = 2; ctx.stroke(); }
        }

        // Stamp Functions
        function drawCorrectedStamp(x, y) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(-2 * Math.PI / 180); 

            const stampColor = '#d93025'; 

            // Outer
            ctx.beginPath();
            ctx.arc(0, 0, 55, 0, 2 * Math.PI);
            ctx.strokeStyle = stampColor;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Inner
            ctx.beginPath();
            ctx.arc(0, 0, 48, 0, 2 * Math.PI);
            ctx.lineWidth = 1;
            ctx.stroke();

            ctx.fillStyle = stampColor;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Center Text
            ctx.font = 'bold 16px "Times New Roman", "PMingLiU", serif'; 
            ctx.fillText('旅車', 0, -8);
            ctx.fillText('專用章', 0, 12);

            // Flower
            drawPlumFlower(ctx, 0, 35, stampColor);

            // Curved Text
            drawCurvedTextFixed(ctx, "BONZ CAR RENTAL CO.", 51.5, stampColor);

            ctx.restore();
        }

        function drawPlumFlower(context, x, y, color) {
            context.save();
            context.translate(x, y);
            context.fillStyle = color;
            for (let i = 0; i < 5; i++) {
                context.beginPath();
                context.rotate(Math.PI * 2 / 5);
                context.arc(0, 5, 2.5, 0, Math.PI * 2);
                context.fill();
            }
            context.beginPath();
            context.arc(0, 0, 1.5, 0, Math.PI * 2);
            context.fill();
            context.restore();
        }

        function drawCurvedTextFixed(context, text, radius, color) {
            context.font = 'bold 11px Arial, sans-serif'; 
            context.fillStyle = color;
            context.textAlign = 'center';
            context.textBaseline = 'middle';

            const startAngle = -220 * (Math.PI / 180); 
            const totalSpan = 260 * (Math.PI / 180);
            const anglePerChar = totalSpan / (text.length - 1);

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const angle = startAngle + (i * anglePerChar);
                
                context.save();
                context.translate(Math.cos(angle) * radius, Math.sin(angle) * radius);
                context.rotate(angle + Math.PI / 2);
                context.fillText(char, 0, 0);
                context.restore();
            }
        }

        function downloadReceipt() {
            const link = document.createElement('a');
            link.download = `receipt_bonz_${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        setTimeout(drawReceipt, 100); 
    </script>
</body>
</html>